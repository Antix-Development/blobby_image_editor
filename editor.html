<!doctype html>
<html lang=en>
<head>
<meta charset=UTF-8>
<title>Blobby Image Editor</title>
<style>:root{--background-color:#333;--text-bright-color:#eee;--text-dark-color:#111;--button-color:#555;--checkbox-color:#666;--input-background-color:#222;--input-border-color:#777;--selected-li-color:#06d;--heading-color:#1af;--sub-heading-color:#fe0;--selected-color:#07f;--table-caption-color:#acf;--code-text-color:#fa5;--code-background-color:#112}*{margin:0;padding:0;box-sizing:border-box;outline:0;user-select:none;border:none;border-radius:3px;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}:disabled,:disabled:hover{filter:brightness(.6)}:disabled:active{scale:1}html{font-size:62.5%}body{width:100vw;height:100vh;overflow:hidden;font-size:1.8rem;background-color:var(--background-color);color:var(--text-bright-color)}label{display:inline-block;line-height:2.8rem}button{margin-top:4px;background-color:var(--button-color);color:var(--text-bright-color);font-size:1.8rem;padding:0 1rem;line-height:2.8rem;cursor:pointer}.item:hover,.listItem:hover,button:hover{filter:brightness(1.5)}.item:active,.listItem:active,button:active{scale:.975}input{background-color:var(--input-background-color);border:2px solid var(--input-border-color);color:var(--text-bright-color);font-size:1.8rem}input[type=number]{text-align:right;direction:rtl;padding:0 3px}input[type=range]{cursor:pointer}input[type=checkbox]{height:0;width:0;visibility:hidden}.checkLabel{top:2px;cursor:pointer;text-indent:-9999px;width:5rem;height:2.8rem;background:var(--input-background-color);border-radius:1.4rem;border:2px solid var(--input-border-color);position:relative}.checkLabel:after{content:'';position:absolute;top:.3rem;left:.3rem;width:1.8rem;height:1.8rem;background:var(--checkbox-color);border-radius:2rem}input:checked+.checkLabel:after{background:var(--selected-color)}input:checked+.checkLabel:after{left:calc(100% - .3rem);transform:translateX(-100%)}input:disabled+.checkLabel{filter:brightness(.6)}hr{margin:1rem 0;width:100%;border:1px solid #fff4}h1{font-size:3.4rem;line-height:4.2rem;color:var(--heading-color)}h2{line-height:3.4rem;color:var(--sub-heading-color)}ol,ul{margin-left:2rem;margin-left:2rem}table{border-collapse:collapse;border:2px solid var(--input-border-color)}caption{caption-side:top;padding:10px;font-weight:700;color:var(--table-caption-color)}td{border:1px solid var(--input-border-color);padding:8px 10px;background-color:var(--input-background-color)}tr:first-child>td{background-color:var(--button-color)!important;color:var(--text-bright-color)}code,pre{white-space:pre;font-family:'Courier New',Courier,monospace}pre{padding-left:4px}select{border:2px solid var(--input-border-color)}select,select>option{background-color:var(--input-background-color);color:var(--text-bright-color);font-size:1.7rem}.row{width:100%}.container{display:grid;grid-template-columns:1fr 512px 512px;grid-template-rows:540px 1fr;gap:3px 3px;grid-auto-flow:row;grid-template-areas:"controlsPanel editorContainer previewContainer" "controlsPanel renderCodePanel renderCodePanel";width:100%;height:100%}.editorContainer{grid-area:editorContainer}.previewContainer{grid-area:previewContainer}.controlsPanel{display:grid;grid-template-columns:1fr;grid-template-rows:auto 1fr;gap:0 3px;grid-auto-flow:row;grid-template-areas:"controlsContainer" "exportedCodePanel";grid-area:controlsPanel}.controlsContainer{grid-area:controlsContainer;display:flex;flex-direction:column;overflow:hidden;padding:0 0 4px 3px}.controlsContainer .row{flex:0 0 auto}.controlsContainer .itemContainer{flex:1 1 auto;min-height:6rem;overflow-y:auto}.renderCodePanel{grid-area:renderCodePanel;overflow:hidden}.exportedCodePanel{grid-area:exportedCodePanel;height:100%;overflow:hidden}#rendererCodeContainer{height:calc(100% - 2.8rem)}#exportedCodeContainer{height:100%}#exportedCodeContainer,#rendererCodeContainer{width:100%;overflow:hidden;background-color:var(--code-background-color);color:var(--code-text-color)}.code{width:100%;height:100%;overflow:scroll}.arrow-function,.bracket,.comment,.curly-brace,.func,.keyword,.length,.number,.parenthesis,.semicolon,.string,literal{font-family:'Courier New',Courier,monospace}.length{color:#afa}.string{color:#5e4}.func{color:#ff0}.number{color:#f48}.curly-brace{color:#f48}.bracket{color:#e7d}.comment{color:#2ae}.parenthesis{color:#1af}.semicolon{color:#eee}.keyword{color:#ff8}.arrow-function{color:#ff8}.literal{color:#e7d}.emphasize{font-weight:650}.right{float:right}.itemContainer{width:100%;height:6rem;background-color:var(--input-background-color);border:2px solid var(--input-border-color);color:var(--text-bright-color);flex-wrap:wrap;overflow-y:scroll}.item{padding:0 8px;margin-left:2px;margin-top:2px;background-color:var(--button-color);flex-grow:0;flex-shrink:0;height:2.8rem}.pad{margin-left:2px;width:.2rem}.item.selected{background-color:var(--selected-color)}.dot{display:block;position:absolute;left:-50px;top:-50px;z-index:100;pointer-events:none}#paletteContainer{display:inline-block}.paletteContainer{display:inline-block;padding:2px;border:2px solid var(--background-color)}.paletteContainer.selected{border:2px solid var(--text-bright-color)}.color{display:inline-block;border-radius:0;width:2rem;margin:0}#help{position:absolute;left:0;top:0;width:100vw;height:100vh;background-color:#0008;z-index:1000;display:none}#helpContainer{position:absolute;left:20%;top:4rem;width:60%;height:calc(100% - 8rem);padding:1rem;background-color:var(--background-color);box-shadow:3px 3px 8px #000;border-radius:5px;overflow:hidden}#helpBody{padding:1rem 1rem;margin:1rem 0;border-radius:3px;background-color:var(--background-color);line-height:2.8rem;overflow-y:scroll;height:calc(100% - 2rem)}#closeHelpButton{width:100%}#messageBox{display:none;z-index:2000;position:absolute;left:50%;bottom:5%;transform:translate(-50%,0);padding:1rem 4rem;border-radius:4px;text-align:center;background-color:var(--button-color);font-weight:700;box-shadow:3px 3px 8px #000}.fade-in{opacity:1;transition:opacity .25s}.fade-out{opacity:0;transition:opacity 1s}#imageBoundsLabel{padding-right:1rem;color:var(--button-color)}#tempCanvas{display:none}.fileInput{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}#colorPicker{position:absolute;left:0;top:0;width:100%;height:100%;z-index:8000;background-color:#00000001;display:none}#colorPickerDialog{position:absolute;text-align:center;background-color:var(--button-color);font-weight:700;box-shadow:3px 3px 8px #000;padding:1rem}.colorInput{display:inline-block;text-align:center;width:5rem!important}.colorInput.selected{border:2px solid var(--text-bright-color)}.colorLabel{min-width:2rem;text-align:left}#colorPicker,#downloadSelect{position:absolute;left:0;top:0;width:100%;height:100%;z-index:8000;background-color:#00000001;display:none}#downloadSelectBody{position:absolute;left:3rem;top:4rem;background-color:var(--background-color);font-weight:700;box-shadow:3px 3px 8px #000;padding:1rem}#downloadSelectList{background-color:var(--input-background-color);border:2px solid var(--input-border-color);min-height:20rem;max-height:40rem;overflow-y:scroll;padding:.25rem}.listItem{padding:0 8px;margin-left:2px;margin-top:2px;background-color:var(--input-background-color);height:2.8rem;list-style:none}.listItem.selected{background-color:var(--selected-color)}</style>
</head>
<body oncontextmenu=return!1>
<img id=dotSelect class=dot src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAMAAAAMCGV4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH6AcVEw4VDhqcvgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAANlBMVEUAAAD+/v3///9k/zBk/zBk/zBk/zBk/zBk/zBk/zBk/zBk/zBk/zBk/zBk/zBk/zBVVVVk/zDhIaLOAAAAEHRSTlMAAAADBh0uYWOptsfX6er8JevjpQAAAAFiS0dEEJWyDSwAAABgSURBVAjXZY9HDsAgDASXUExH+//PhqKghMxt1nIDoJTE2moUTJRLXCQ3tTB7q63PLD1QicFcAxOYAGFe2oNMQaS/HjwjKu12y4pGvV2z/epn/zkfx34c9/Xgc//g9d8N0KMF/NhuiJIAAAAASUVORK5CYII=">
<img id=dotHover class=dot src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAABmJLR0QAVQBVAFV4xrLkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH6AcVEw0xGTQrrAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAuUlEQVQoz6WTyw3CMBBEHwRRBBItpAz6iFIdDaSFXLhTAxyoIMnjMpYQChBgJGvl9Yz3Z0MwTSPTNKI2aqde1SG2UxvmEFGt9r5Hr9ZzwksIZ7VV92oV28ZvePWjuEQ8qluVmbXNuWoPUGosEV8JHy8oGTSkGSY1Fqw2/I5009S2RLwP/7pSB6ACNsDIZ1TAAIxr4BbnjmUovNsaOGVzWCguvNN/3c64fptzxL+9sKcLvnvbz/jmV90Bu4EY8qPpzHsAAAAASUVORK5CYII=">
<div id=messageBox><label id=messageLabel>You can't see me!</label></div>
<canvas id=tempCanvas width=512 height=512></canvas>
<div id=colorPicker>
<div id=colorPickerDialog>
<div class=row>
<div class=colorInput id=redColorButton onclick=setSelectedColorIndex(0,this)></div>
<div class=colorInput id=greenColorButton onclick=setSelectedColorIndex(1,this)></div>
<div class=colorInput id=blueColorButton onclick=setSelectedColorIndex(2,this)></div>
</div>
<div class=row>
<label class=colorLabel>R</label>
<input type=range id=redRange min=0 max=15 step=1 value=0 oninput=updateColorRed(this.value,!0)>
</div>
<div class=row>
<label class=colorLabel>G</label>
<input type=range id=greenRange min=0 max=15 step=1 value=0 oninput=updateColorGreen(this.value,!0)>
</div>
<div class=row>
<label class=colorLabel>B</label>
<input type=range id=blueRange min=0 max=15 step=1 value=0 oninput=updateColorBlue(this.value,!0)>
</div>
</div>
</div>
<div id=downloadSelect>
<div id=downloadSelectBody>
<div class=row>
<label>Select blobby images to download</label>
</div>
<div class=row>
<div class=row id=downloadSelectList>
</div>
</div>
<div class=row>
<button onclick=selectSelectedImageForDownload()>Selected</button>
<button onclick=selectAllImagesForDownload()>All</button>
<button onclick=selectNoImagesForDownload()>None</button>
<button onclick=downloadImages()>Okay</button>
<button onclick=cancelImageDownload()>Cancel</button>
</div>
</div>
</div>
<div class=container>
<div class=editorContainer>
<div class=row>
<label class=emphasize>Editor</label>
<label id=imageBoundsLabel class=right></label>
</div>
<div><canvas id=editorCanvas width=512 height=512></canvas></div>
</div>
<div class=previewContainer>
<div class="row emphasize">
<label>Preview</label>
<select id=previewScaleSelect class=right oninput=previewScaleSelected(this.selectedIndex)>
<option id=scale0Option value=1>1.0 (512x512)</option>
<option id=scale1Option value=.5>0.5 (256x256)</option>
<option id=scale2Option value=.25>0.25 (128x128)</option>
<option id=scale3Option value=.125>0.125 (64x64)</option>
<option id=scale4Option value=.0625>0.250 (32x32)</option>
</select>
</div>
<div><canvas id=previewCanvas width=512 height=512></canvas></div>
</div>
<div class=renderCodePanel>
<div class="row emphasize"><label>Blobby Image Renderer Code</label></div>
<div class=row id=rendererCodeContainer onclick=writeClipboardText(blobbyRenderCode)>
<pre class=code><code id=blobbyRenderCode></code></pre>
</div>
</div>
<div class=controlsPanel>
<div class=controlsContainer>
<div class=row>
<div class="row emphasize"><label>Images</label></div>
<div id=imageButtonContainer class="row itemContainer" ondrop=imageDropHandler(event) ondragover=imageDragOverHandler(event)></div>
<label>Name</label>
<input id=imageNameInput onblur=inputActivated(!1) onfocus=inputActivated(!0) onchange=updateImageName(this.value)>
<button id=addImageButton onclick=addImage()>New Image</button>
<button id=deleteImageButton onclick=deleteImage()>Delete Image</button>
<button onclick=duplicateImage() id=duplicateImageButton>Duplicate</button>
<button onclick=flipImageX() id=flipImageXButton>Flip On X Axis</button>
<button onclick=flipImageY() id=flipImageYButton>Flip On Y Axis</button>
<button id=saveImagesButton onclick=saveImages()>Save Images</button>
<button id=downloadImagesButton onclick=openDownloadSelect()>Download Images</button>
<input type=file name=fileInput id=fileInput class=fileInput accept=application/json onchange=uploadImages(event)>
<label id=uploadImagesButton class=item for=fileInput>Upload Images</label>
</div>
<div class=row>
<div class="row emphasize"><label>Components</label></div>
<div id=componentButtonContainer class="row itemContainer"></div>
<label>Name</label>
<input id=componentNameInput onblur=inputActivated(!1) onfocus=inputActivated(!0) onchange=updateComponentName(this.value)>
<button onclick=addComponent() id=addComponentButton>New Component</button>
<button onclick=deleteComponent() id=deleteComponentButton>Delete Component</button>
<button onclick=duplicateComponent(10) id=duplicateComponentButton>Duplicate</button>
<button onclick=flipComponentX() id=flipComponentXButton>Flip On X Axis</button>
<button onclick=flipComponentY() id=flipComponentYButton>Flip On Y Axis</button>
<label>Blobbiness</label>
<input type=range id=componentBlobbinessRange min=0 max=1 step=.05 value=0 oninput=updateComponentBlobbiness(this.value,1)>
<input type=number id=componentBlobbinessInput min=0 max=1 step=.05 value=0 onblur=inputActivated(!1) onfocus=inputActivated(!0) oninput=updateComponentBlobbiness(this.value,0)>
<label>Z-Index</label>
<input type=range id=componentZIndexRange min=0 max=9 step=1 value=0 oninput=updateComponentZindex(this.value,1)>
<input type=number id=componentZIndexInput size=1 min=0 max=5 step=1 value=0 onblur=inputActivated(!1) onfocus=inputActivated(!0) onchange=updateComponentZindex(this.value,0)>
</div>
<div class=row>
<label>Palette</label>
<div id=paletteContainer>
</div>
<button id=openColorPickerButton onclick=openColorPicker(openColorPickerButton)>Modify Palette</button>
</div>
<div class=row>
<div class="row emphasize"><label>Points</label></div>
<div id=pointButtonContainer class="row itemContainer"></div>
<button onclick=deletePoint() id=deletePointButton>Delete Point</button>
<button onclick=clearPoints() id=clearPointsButton>Clear Points</button>
<label>X:</label>
<input id=pointXInput type=number min=0 max=510 step=2 onblur=inputActivated(!1) onfocus=inputActivated(!0) oninput=updatePointX(this.value)>
<label>Y:</label>
<input id=pointYInput type=number min=0 max=510 step=2 onblur=inputActivated(!1) onfocus=inputActivated(!0) oninput=updatePointY(this.value)>
</div>
<div class=row>
<div class="row emphasize"><label>Export</label></div>
<label>Comments</label>
<input id=generateCommentsCheckbox type=checkbox onchange=enableCommentGeneration(this.checked)>
<label class=checkLabel for=generateCommentsCheckbox>Toggle</label>
<label>Indent</label>
<input id=indentCodeCheckbox type=checkbox onchange=enableIndentGeneration(this.checked)>
<label class=checkLabel for=indentCodeCheckbox>Toggle</label>
<label>Indent Size</label>
<input id=indentSizeInput type=number min=1 max=8 step=1 value=1 onblur=inputActivated(!1) onfocus=inputActivated(!0) oninput=setIndentSize(this.value)>
<label>Compact</label>
<input id=compactCodeCheckbox type=checkbox onchange=setCodeCompacting(this.checked)>
<label class=checkLabel for=compactCodeCheckbox>Toggle</label>
<button id=exportImagesButton onclick=exportImages()>Export Images</button>
</div>
</div>
<div class=exportedCodePanel>
<div class=row id=exportedCodeContainer onclick=writeClipboardText(outputCode)><pre class=code><code id=outputCode></code></pre>
</div>
</div>
</div>
</div>
<div id=help>
<div id=helpContainer>
<div id=helpBody>
<h1>Blobby Image Editor</h1>
<hr>
A basic tool for creating and editing 2d blobby images which can be used as assets in web apps and games.
<br>
<br>
<h2>What's New</h2>
<hr>
<ul>
<li>Component points now encoded to ASCII string to reduce exported code size. Thanks to <a href=https://github.com/xem target=_blank>xem</a> for suggesting.</li>
<li>Image dimensions also encoded into an ASCII string.</li>
<li>Viewer now generates SVG image. Thanks again to <a href=https://github.com/xem target=_blank>xem</a> for suggesting it.</li>
<li>Viewer code grew in size but offset by size savings in exported code.</li>
<li>Help dialog improved layout and also now mirrors readme.md.</li>
<li>Major overhaul of the syntax highlighting so it can handle literal template strings.</li>
</ul>
<br>
<br>
<h2>History</h2>
<hr>
<details><summary>v0.9.0 (28 Jul 2024)</summary><p>
<br>
- Initial public release
<br>
</p></details>
<br>
<h2>Getting Started</h2>
<hr>
<ol>
<li>Click the <b><i>New Image</i></b> button to create a new blobby image.<br></li>
<li>Click the <b><i>New Component</i></b> button to add a new component to the selected blobby image.<br></li>
<li>Click anywhere in the editor pane to add points to the selected component.<br></li>
<li>Create and manipulate more components and blobby images.<br></li>
<li>Export and use the blobby images inside your game.<br></li>
</ol>
<br>
<h2>Selecting Things</h2>
<hr>
<ul>
<li><b><i>Left</i></b> click a point in the editor pane to select it.<br></li>
<li><b><i>Right</i></b> click a component in the editor pane to select it.<br></li>
<li>Press the <b><i>Tilde</i></b> key to select the next point in the selected component.</li>
<li>Hold the <b><i>Shift</i></b> key and press the <b><i>Tilde</i></b> key to select the previous point in the selected component.</li>
<li>Hold the <b><i>Alt</i></b> key and press the <b><i>Tilde</i></b> key to cycle through the components in the selected blobby image.</li>
<li>Hold the <b><i>Ctrl</i></b> key and press the <b><i>Tilde</i></b> key to cycle through the blobby images.</li>
</ul>
<br>
<h2>Moving Things</h2>
<hr>
<ul>
<li><b><i>Left</i></b> click and hold points from the selected component in the editor pane, and drag them about.</li>
<li>Use <b><i>Arrow</i></b> keys to move the selected point.</li>
<li>Hold <b><i>Shift</i></b> and press <b><i>Arrow</i></b> keys to move the selected component.</li>
<li>Hold <b><i>Ctrl</i></b> and press <b><i>Arrow</i></b> keys to move the selected blobby image.</li>
</ul>
<br>
<h2>Deleting Things</h2>
<hr>
<ul>
<li>Press the <b><i>Delete</i></b> key to delete the selected point.</li>
<li>Hold <b><i>Shift</i></b> and press the <b><i>Delete</i></b> key to delete the selected component.</li>
<li>Hold <b><i>Ctrl</i></b> and press the <b><i>Delete</i></b> key to delete the selected blobby image.</li>
</ul>
<br>
<h2>Components</h2>
<hr>
<ul>
<li>Use the <b><i>Blobbiness</i></b> slider to change the blobbiness of the selected component.</li>
<li>Use the <b><i>Z-Index</i></b> slider to change the selected components draw order.</li>
<li>You can <b><i>Double-Click</i></b> a palette to modify its colors.</li>
<li>The other controls in this pane should be self explanatory..</li>
</ul>
<br>
<h2>Uploading and Downloading Images</h2>
<hr>
<ul>
<li>Click the <b><i>Download Images</i></b> button to open a dialog where you can select images to download.</li>
<li>Click the <b><i>Upload Images</i></b> button to upload previously downloaded images..</li>
</ul>
<br>
<h2>Exporting Images</h2>
<hr>
<ul>
<li>Click the <b><i>Export Images</i></b> button to generate JavaScript code describing the images, and copy it to the clipboard.</li>
<li>Fiddle with the other controls to modify the format of the generated code.</li>
<li>You can also drag the names around in the blobby image list to change the order in which the are exported.</li>
<li><b><i>Note</i></b> Exported images will be clipped to their bounding boxes.</li>
<li><b><i>Note</i></b> Exported images will be scaled according to the selected scale in the preview panel.</li>
</ul>
<br>
The exported data will be in the form of an array named <b><i>blobbyImages</i></b>, which contains the following data...
<br>
<table>
<caption>blobbyImages</caption>
<tbody>
<tr class=emphasize>
<td>Index</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr>
<td>0</td>
<td>array</td>
<td><b><i>ImageDefs</i></b>.</td>
</tr>
<tr>
<td>length - 2</td>
<td>number</td>
<td>Line width used when rendering.</td>
</tr>
<tr>
<td>length - 1</td>
<td>array</td>
<td>Palette strings, eight sets of 3 in total.</td>
</tr>
</tbody>
</table>
<br>
<table>
<caption>ImageDef</caption>
<tbody>
<tr class=emphasize>
<td>Index</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr>
<td>0</td>
<td>array</td>
<td><b><i>Components</i></b>, sorted into ascending z-index order.</td>
</tr>
<tr>
<td>length - 1</td>
<td>encoded array</td>
<td>Image width and height.</td>
</tr>
</tbody>
</table>
<br>
<table>
<caption>Component</caption>
<tbody>
<tr class=emphasize>
<td>Index</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr>
<td>0</td>
<td>encoded array</td>
<td><b><i>Points</i></b>, sorted into clockwise order.</td>
</tr>
<tr>
<td>length - 2</td>
<td>number</td>
<td>Blobbiness.</td>
</tr>
<tr>
<td>length - 1</td>
<td>number</td>
<td>Palette.</td>
</tr>
</tbody>
</table>
<br>
<h2>Export Caveats</h2>
<hr>
<ul>
<li>Component coordinates are encoded as whole numbers between 0 and 511. Because scaled output can result in floating point numbers, these coordinates will be rounded to the nearest whole number. To avoid image distortion, align your points with coordinates that will not result in floating point numbers.</li>
</ul>
<br>
<h2>Miscellaneous</h2>
<hr>
<ul>
<li>Everything that moves does so in 2 pixel increments to avoid floating point numbers.</li>
<li>All blobby images are stored in your web browsers `<i>localStorage</i>`.</li>
<li>Currently there is no <i>UNDO</i> functionality.</li>
<li>Seems to work in Chrome and FireFox, </li>
</ul>
<br>
Blobby image editor is a tool created for JS13K 2024 by Cliff Earl, Antix Development.
<br>
<br>
<h2>Thanks</h2>
If you end up using Blobby Image Editor maybe you'd consider <a href=https://www.buymeacoffee.com/antixdevelu target=_blank>buying me a coffee</a>
<br>
<br>
<button id=closeHelpButton onclick=showHelp(!1)>OKAY</button>
</div>
</div>
</div>
</body>
<script>let selectedImage,selectedImageListItem,selectedComponent,selectedComponentListItem,hoveredPoint,selectedPoint,selectedPalette,selectedPaletteId,selectedColorInput,selectedColorIndex,colorPickerOpen,lastClickTime,activePad,insertWidth,buttonBeingDragged,doNotRepaint,editorBounds,mouseX,mouseY,roundedX,roundedY,dragging,helpVisible,downloadSelectVisible,anInputIsActive,dataFile,unsavedChanges,log=e=>console.log(e),warn=e=>console.warn(e),getByID=e=>document.getElementById(e),createElement=e=>document.createElement(e),enableElement=(e,t=0)=>e.disabled=!t,setElementPosition=(e,t,n)=>{e.style.left=`${t}px`,e.style.top=`${n}px`},showElement=(e,t=!0)=>e.style.display=t?"block":"none",clamp=(e,t,n)=>min(max(e,t),n),notify=(e,t=1750)=>{showElement(messageBox),messageLabel.innerHTML=e,messageBox.classList.remove("fade-out"),messageBox.classList.add("fade-in"),setTimeout((e=>{messageBox.classList.add("fade-out")}),t)},showHelp=(e=!0)=>{showElement(messageBox,!1),showElement(help,e),helpVisible=e},getButtonByID=(e,t)=>{const n=t.children;for(let t=0;t<n.length;t++){const o=n[t];if(1*o.id===e)return o}return null},getFromArrayByID=(e,t)=>{for(let n=0;n<t.length;n++)if(t[n].id===1*e)return t[n];return null},cycleThroughButtonsInArray=(e,t,n,o=1)=>{let a=t.indexOf(e)+o;a===t.length&&(a=0),a<0&&(a=t.length-1),getButtonByID(t[a].id,n).onclick()},arrayNotEmpty=e=>e.length>0,inputActivated=e=>anInputIsActive=e,M=Math,PI=M.PI,floor=M.floor,round=M.round,sqrt=M.sqrt,sin=M.sin,cos=M.cos,min=M.min,max=M.max,editorContext=editorCanvas.getContext("2d"),previewContext=previewCanvas.getContext("2d"),tempContext=tempCanvas.getContext("2d",{willReadFrequently:!0}),editorBackgroundCanvas=createElement("canvas"),previewBackgroundCanvas=createElement("canvas"),dotOffsetX=-8,dotOffsetY=-4,paletteSwatchContainers=[],palettes=[],padID=0,polygonHighlightColor="#fff9",polygonCenterColor="#08f",pointColor="#f8fc",lineWidth=4,previewScale=1,saveFileName="com.antix.blobby.image.editor",exportedBlobbyImageID="exportedBlobbyImage",loadDataFile=()=>localStorage.getItem(saveFileName),saveDataFile=()=>{localStorage.setItem(saveFileName,JSON.stringify(dataFile)),unsavedChanges=!1},resetDataFile=()=>{dataFile={uid:0,palettes:["fff,aaa,444","efe,afa,4a4","fcc,f55,a22","eef,aaf,44a","fee,a84,542","ffd,ae7,470","eef,aac,446","fef,faf,a4a"],images:[],generateComments:!0,indentCode:!0,indentSize:2,compactCode:!1},saveDataFile()},openColorPicker=e=>{const t=e.getBoundingClientRect();showElement(colorPicker),setElementPosition(colorPickerDialog,t.left-55,t.bottom),colorPickerOpen=!0,selectedColorInput&&selectedColorInput.classList.remove("selected"),selectedColorInput=redColorButton,selectedColorInput.classList.add("selected"),selectedColorInput.click();const n=dataFile.palettes[selectedPaletteId].split(","),o=n[0];redRange.value=parseInt(o.substr(0,1),16),greenRange.value=parseInt(o.substr(1,1),16),blueRange.value=parseInt(o.substr(2,1),16),redColorButton.style.backgroundColor=`#${n[0]}`,redColorButton.style.color=`#${invertColor(n[0])}`,redColorButton.innerHTML=n[0],greenColorButton.style.backgroundColor=`#${n[1]}`,greenColorButton.style.color=`#${invertColor(n[1])}`,greenColorButton.innerHTML=n[1],blueColorButton.style.backgroundColor=`#${n[2]}`,blueColorButton.style.color=`#${invertColor(n[2])}`,blueColorButton.innerHTML=n[2]},setSelectedColorIndex=(e,t)=>{selectedColorIndex=e,selectedColorInput&&selectedColorInput.classList.remove("selected"),selectedColorInput=t,selectedColorInput.classList.add("selected");const n=dataFile.palettes[selectedPaletteId].split(",")[e];redRange.value=parseInt(n.substr(0,1),16),greenRange.value=parseInt(n.substr(1,1),16),blueRange.value=parseInt(n.substr(2,1),16)},updateColorRed=e=>{const t=dataFile.palettes[selectedPaletteId].split(",")[selectedColorIndex],n="0123456789abcdef"[e]+t.substring(1);updatePalette(n)},updateColorGreen=e=>{const t=dataFile.palettes[selectedPaletteId].split(",")[selectedColorIndex],n=t[0]+"0123456789abcdef"[e]+t[2];updatePalette(n)},updateColorBlue=e=>{const t=dataFile.palettes[selectedPaletteId].split(",")[selectedColorIndex].substring(0,2)+"0123456789abcdef"[e];updatePalette(t)},updatePalette=e=>{selectedColorInput.innerHTML=e,selectedColorInput.style.backgroundColor=`#${e}`,selectedColorInput.style.color=`#${invertColor(e)}`,selectedPalette.children[selectedColorIndex].style.backgroundColor=`#${e}`;const t=dataFile.palettes[selectedPaletteId];switch(selectedColorIndex){case 0:e+=t.substring(3);break;case 1:e=t.substring(0,4)+e+t.substring(7);break;case 2:e=t.substring(0,8)+e}dataFile.palettes[selectedPaletteId]=e,palettes[selectedPaletteId]=e.split(","),repaintEditor()},invertColor=e=>((1<<24)+(255-parseInt(e[0]+e[0],16)<<16)+(255-parseInt(e[1]+e[1],16)<<8)+(255-parseInt(e[2]+e[2],16))).toString(16).slice(1),initPalettes=e=>{for(let e=0;e<dataFile.palettes.length;e++){const t=dataFile.palettes[e].split(","),n=createElement("div");n.classList.add("rowx","paletteContainer"),palettes.push(t);for(let o=0;o<t.length;o++){const a=t[o],i=createElement("div");i.innerHTML="&nbsp;",i.style.backgroundColor=`#${a}`,i.classList.add("color"),n.appendChild(i),n.id=e}paletteContainer.appendChild(n),paletteSwatchContainers.push(n),n.onclick=e=>{if(!n.disabled){if(selectedPalette&&(selectedPalette.classList.remove("selected"),selectedPalette===n)){performance.now()-lastClickTime<=250&&openColorPicker(n)}lastClickTime=performance.now(),selectedPalette=n,selectedPalette.classList.add("selected"),selectedPaletteId=1*n.id,selectedComponent.palette=selectedPaletteId,repaintEditor()}}}},enablePaletteSwatches=(e=!0)=>paletteSwatchContainers.forEach((t=>{t.disabled=!e})),resetPadStyle=e=>{e.style.width=".2rem",e.style.border="none"},imageDropHandler=e=>{if(e.preventDefault(),activePad){resetPadStyle(activePad);const e=buttonBeingDragged.nextElementSibling;imageButtonContainer.insertBefore(buttonBeingDragged,activePad.nextElementSibling),imageButtonContainer.insertBefore(e,buttonBeingDragged.nextElementSibling);const t=[],n=Array.from(imageButtonContainer.getElementsByClassName("imageButton"));for(let e=0;e<n.length;e++)t.push(getFromArrayByID(n[e].id,dataFile.images));dataFile.images=t,unsavedChanges=!0}buttonBeingDragged=null,activePad=null},imageDragOverHandler=e=>{e.preventDefault();const t=e.pageX,n=e.pageY,o=Array.from(imageButtonContainer.getElementsByClassName("pad"));for(let e=0;e<o.length;e++){const a=o[e],i=a.getBoundingClientRect();t>i.left-8&&t<i.right+8&&n>i.top-2&&n<i.bottom+2?a.nextElementSibling===buttonBeingDragged||a.previousElementSibling===buttonBeingDragged?(resetPadStyle(a),activePad=null):(a.style.width=`${insertWidth}px`,activePad=a,a.style.border="2px solid var(--text-bright-color)"):resetPadStyle(a)}},addPadToImageButtonContainer=e=>{if(!imageButtonContainer.lastElementChild||imageButtonContainer.lastElementChild&&!imageButtonContainer.lastElementChild.classList.contains("pad")){const e=createElement("label");e.classList.add("pad"),e.id="pad"+padID++,e.innerHTML="&nbsp;",imageButtonContainer.appendChild(e)}},saveImages=e=>saveDataFile(),initImageArray=e=>{imageButtonContainer.innerHTML="";for(let e=0;e<dataFile.images.length;e++)addImageToImageButtonContainer(dataFile.images[e]);addPadToImageButtonContainer()},addImageToImageButtonContainer=e=>{addPadToImageButtonContainer();let t=createElement("label");return t.classList.add("item","imageButton"),t.id=e.id,t.innerHTML=e.name,imageButtonContainer.appendChild(t),t.scrollIntoView(),t.draggable=!0,t.ondragstart=e=>{insertWidth=t.getBoundingClientRect().width+10,buttonBeingDragged=t},t.ondragend=e=>{t.style.cursor="default"},t.onclick=e=>{selectedImageListItem&&selectedImageListItem.classList.remove("selected"),t.classList.add("selected");const n=getFromArrayByID(t.id,dataFile.images);selectedImageListItem=t,selectedImage=n,imageNameInput.value=n.name,imageNameInput.disabled=!1,deleteImageButton.disabled=!1,downloadImagesButton.disabled=!1,duplicateImageButton.disabled=!1,flipImageXButton.disabled=!1,flipImageYButton.disabled=!1,saveImagesButton.disabled=!1,openColorPickerButton.disabled=!0,pointButtonContainer.innerHTML="",disablePointUI(),selectedComponent=null,selectedPoint=null,updateDots(),disableComponentUI(),initComponentList(),n.components.length>0&&(addComponentButton.disabled=!1),repaintEditor()},unsavedChanges=!0,t},duplicateImage=e=>{const t=selectedImage;if(addImage(`${selectedImage.name} - Copy`),arrayNotEmpty(t.components)){const e=t.components;for(let t=0;t<e.length;t++){const n=e[t],o=n.points;addComponent(),selectedComponent.name=n.name,selectedComponent.z=1*n.z,selectedComponent.blobbiness=1*n.blobbiness,selectedComponent.palette=1*n.palette,componentNameInput.value=selectedComponent.name,selectedComponentListItem.innerHTML=selectedComponent.name;for(let e=0;e<o.length;e++){const t=o[e];addPoint(t.x,t.y)}}}updateDots(),repaintEditor(),unsavedChanges=!0},getImageCenter=e=>{let t=512,n=512,o=0,a=0;return selectedImage.components.forEach((e=>{e.points.forEach((e=>{e.x<t&&(t=e.x),e.x>o&&(o=e.x),e.y<n&&(n=e.y),e.y>a&&(a=e.y)}))})),{x:(t+o)/2,y:(n+a)/2}},flipImageX=e=>{if(arrayNotEmpty(selectedImage.components)){const e=getImageCenter(),t=selectedImage.components;for(let n=0;n<t.length;n++){const o=t[n].points;for(let t=0;t<o.length;t++){const n=o[t];n.x=round(e.x-(n.x-e.x)),selectedPoint&&(getButtonByID(n.id,pointButtonContainer).innerHTML=`${n.x}, ${n.y}`)}}updateDots(),repaintEditor(),unsavedChanges=!0}},flipImageY=e=>{if(arrayNotEmpty(selectedImage.components)){const e=getImageCenter(),t=selectedImage.components;for(let n=0;n<t.length;n++){const o=t[n].points;for(let t=0;t<o.length;t++){const n=o[t];n.y=round(e.y-(n.y-e.y)),selectedPoint&&(getButtonByID(n.id,pointButtonContainer).innerHTML=`${n.x}, ${n.y}`)}}updateDots(),repaintEditor(),unsavedChanges=!0}},addImage=e=>{let t={id:dataFile.uid++,type:"image",name:e||`image${dataFile.uid}`,x:0,y:0,w:0,h:0,components:[]};return dataFile.images.push(t),selectedImage=null,selectedComponent=null,selectedPoint=null,addImageToImageButtonContainer(t).onclick(),addPadToImageButtonContainer(),addComponentButton.disabled=!1,saveImagesButton.disabled=!1,repaintEditor(),unsavedChanges=!0,selectedImage},deleteImage=e=>{if(!selectedImage)return;let t=dataFile.images;for(let e=0;e<t.length;e++){t[e]===selectedImage&&(imageButtonContainer.removeChild(selectedImageListItem.nextElementSibling),imageButtonContainer.removeChild(selectedImageListItem),selectedImageListItem=null,t.splice(e,1),selectedImage=null,outputCode.innerHTML="",imageNameInput.value="",imageNameInput.disabled=!0,deleteImageButton.disabled=!0,downloadImagesButton.disabled=!0,duplicateImageButton.disabled=!0,flipImageXButton.disabled=!0,flipImageYButton.disabled=!0,componentButtonContainer.innerHTML="",pointButtonContainer.innerHTML="",selectedComponent=null,selectedPoint=null,disableComponentUI(),disablePointUI(),addComponentButton.disabled=!0,updateDots(),repaintEditor(),unsavedChanges=!0)}},updateImageName=e=>{selectedImage&&(selectedImage.name=imageNameInput.value,selectedImageListItem.innerHTML=selectedImage.name,unsavedChanges=!0)},initComponentList=e=>{componentButtonContainer.innerHTML="";for(let e=0;e<selectedImage.components.length;e++)addComponentToList(selectedImage.components[e])},addComponentToList=e=>{let t=createElement("label");return t.classList.add("item"),t.id=e.id,t.innerHTML=e.name,componentButtonContainer.appendChild(t),t.scrollIntoView(),t.onclick=e=>{selectedComponentListItem&&(selectedComponentListItem.classList.remove("selected"),setElementPosition(dotSelect,-50,-50),setElementPosition(dotHover,-50,-50)),t.classList.add("selected");const n=getFromArrayByID(t.id,selectedImage.components);selectedComponentListItem=t,selectedComponent=n,componentNameInput.value=n.name,componentBlobbinessInput.value=n.blobbiness,componentBlobbinessRange.value=n.blobbiness,componentZIndexInput.value=n.z,componentZIndexRange.value=n.z,componentNameInput.disabled=!1,addComponentButton.disabled=!1,deleteComponentButton.disabled=!1,componentBlobbinessRange.disabled=!1,componentBlobbinessInput.disabled=!1,componentZIndexRange.disabled=!1,componentZIndexInput.disabled=!1,duplicateComponentButton.disabled=!1,flipComponentXButton.disabled=!1,flipComponentYButton.disabled=!1;const o=paletteContainer.children[n.palette];selectedPalette&&selectedPalette.classList.remove("selected"),selectedPalette=o,o.classList.add("selected"),o.disabled=!1,selectedPoint=null,selectedPaletteId=1*o.id,enablePaletteSwatches(),openColorPickerButton.disabled=!1,initComponentPointsArray(),n.points.length>0&&(clearPointsButton.disabled=!1,getButtonByID(n.points[0].id,pointButtonContainer).onclick()),updateDots(),repaintEditor()},t},addComponent=e=>{let t={id:dataFile.uid++,type:"component",name:`component${dataFile.uid}`,center:{x:0,y:0},blobbiness:0,z:0,points:[],palette:0};return selectedImage.components.push(t),addComponentToList(t).onclick(),selectedPaletteId=0,addComponentButton.disabled=!1,unsavedChanges=!0,t},deleteComponent=e=>{if(!selectedComponent)return;let t=selectedImage.components;for(let e=0;e<t.length;e++){t[e]===selectedComponent&&(componentButtonContainer.removeChild(selectedComponentListItem),selectedComponentListItem=null,t.splice(e,1),selectedComponent=null,selectedPoint=null,pointButtonContainer.innerHTML="",disablePointUI(),disableComponentUI(),updateDots(),repaintEditor(),unsavedChanges=!0)}},disableComponentUI=e=>{componentNameInput.value="",componentNameInput.disabled=!0,componentBlobbinessRange.value=0,componentBlobbinessRange.disabled=!0,componentBlobbinessInput.value="",componentBlobbinessInput.disabled=!0,componentZIndexRange.value=0,componentZIndexRange.disabled=!0,componentZIndexInput.value="",componentZIndexInput.disabled=!0,selectedPalette&&selectedPalette.classList.remove("selected"),enablePaletteSwatches(!1),deleteComponentButton.disabled=!0,duplicateComponentButton.disabled=!0,flipComponentXButton.disabled=!0,flipComponentYButton.disabled=!0},updateComponentName=e=>{selectedComponent&&(selectedComponent.name=componentNameInput.value,selectedComponentListItem.innerHTML=selectedComponent.name,unsavedChanges=!0)},updateComponentBlobbiness=(e,t)=>{t?componentBlobbinessInput.value=e:(e=e<0?0:e>1?1:e,componentBlobbinessInput.value=e,componentBlobbinessRange.value=e),selectedComponent.blobbiness=1*e,repaintEditor(),unsavedChanges=!0},updateComponentZindex=(e,t)=>{t?componentZIndexInput.value=e:(e=e<0?0:e>5?5:e,componentZIndexInput.value=e,componentZIndexRange.value=e),selectedComponent.z=1*e,repaintPreview(),unsavedChanges=!0},flipComponentX=e=>{const t=selectedComponent.center,n=selectedComponent.points;for(let e=0;e<n.length;e++){const o=n[e];o.x=round(t.x-(o.x-t.x)),getButtonByID(o.id,pointButtonContainer).innerHTML=`${o.x}, ${o.y}`}updateDots(),repaintEditor(),unsavedChanges=!0},flipComponentY=e=>{const t=selectedComponent.center,n=selectedComponent.points;for(let e=0;e<n.length;e++){const o=n[e];o.y=round(t.y-(o.y-t.y)),getButtonByID(o.id,pointButtonContainer).innerHTML=`${o.x}, ${o.y}`}updateDots(),repaintEditor(),unsavedChanges=!0},duplicateComponent=e=>{const t=selectedComponent,n=t.points;addComponent(),selectedComponent.z=1*t.z,selectedComponent.blobbiness=1*t.blobbiness,selectedComponent.palette=1*t.palette;for(let t=0;t<n.length;t++){const o=n[t];addPoint(clamp(o.x+e,0,510),clamp(o.y+e,0,510))}updateDots(),repaintEditor(),unsavedChanges=!0},addPoint=(e=0,t=0)=>{const n={id:dataFile.uid++,type:"point",x:e,y:t,a:0};return selectedComponent.points.push(n),addPointToPointButtonContainer(n).onclick(),deletePointButton.disabled=!1,clearPointsButton.disabled=!1,pointXInput.disabled=!1,pointYInput.disabled=!1,n},disablePointUI=e=>{deletePointButton.disabled=!0,clearPointsButton.disabled=!0,pointXInput.value="",pointXInput.disabled=!0,pointYInput.value="",pointYInput.disabled=!0},getPointByID=e=>{for(let t=0;t<selectedComponent.points.length;t++)if(selectedComponent.points[t].id===1*e)return selectedComponent.points[t];return null},moveSinglePoint=(e,t,n)=>{e.x=clamp(e.x+t,0,510),e.y=clamp(e.y+n,0,510);const o=getButtonByID(e.id,pointButtonContainer);o&&(o.innerHTML=`${e.x}, ${e.y}`,e==selectedPoint&&(pointXInput.value=e.x,pointYInput.value=e.y)),unsavedChanges=!0},moveMultiplePoints=(e,t,n,o)=>{if(o&&selectedImage){const n=selectedImage.components;for(let o=0;o<n.length;o++){const a=n[o];for(let n=0;n<a.points.length;n++){const o=a.points[n];o.x=clamp(o.x+e,0,510),o.y=clamp(o.y+t,0,510);const i=getButtonByID(o.id,pointButtonContainer);i&&(i.innerHTML=`${o.x}, ${o.y}`,o==selectedPoint&&(pointXInput.value=o.x,pointYInput.value=o.y))}}return updateDots(),repaintEditor(),void(unsavedChanges=!0)}if(selectedPoint){if(n)for(let n=0;n<selectedComponent.points.length;n++)moveSinglePoint(selectedComponent.points[n],e,t);else moveSinglePoint(selectedPoint,e,t);pointXInput.value=selectedPoint.x,pointYInput.value=selectedPoint.y,updateDots(),repaintEditor(),unsavedChanges=!0}},updateDots=e=>{if(setElementPosition(dotHover,-50,-50),selectedPoint){let e=editorBounds.left+selectedPoint.x+dotOffsetX,t=editorBounds.top+selectedPoint.y+dotOffsetY;setElementPosition(dotSelect,e,t)}else setElementPosition(dotSelect,-50,-50)},initComponentPointsArray=e=>{pointButtonContainer.innerHTML="";for(let e=0;e<selectedComponent.points.length;e++)addPointToPointButtonContainer(selectedComponent.points[e])},addPointToPointButtonContainer=e=>{let t=createElement("span");return t.classList.add("item"),t.id=e.id,t.innerHTML=`${e.x}, ${e.y}`,pointButtonContainer.appendChild(t),t.onclick=n=>{selectedPoint!==t&&(selectedPoint&&getButtonByID(selectedPoint.id,pointButtonContainer).classList.remove("selected"),t.classList.add("selected"),selectedPoint=getPointByID(t.id),deletePointButton.disabled=!1,pointXInput.value=e.x,pointXInput.disabled=!1,pointYInput.value=e.y,pointYInput.disabled=!1,x=editorBounds.left+selectedPoint.x+dotOffsetX,y=editorBounds.top+selectedPoint.y+dotOffsetY,setElementPosition(dotHover,-50,-50),setElementPosition(dotSelect,x,y))},t.onpointerenter=e=>{editorBounds=editorCanvas.getBoundingClientRect();let n=getPointByID(t.id);x=editorBounds.left+n.x+dotOffsetX,y=editorBounds.top+n.y+dotOffsetY,setElementPosition(dotHover,x,y)},unsavedChanges=!0,t},deletePoint=e=>{const t=selectedComponent.points;for(let e=0;e<t.length;e++)if(t[e]===selectedPoint)return pointButtonContainer.removeChild(getButtonByID(selectedPoint.id,pointButtonContainer)),selectedPoint=null,t.splice(e,1),disablePointUI(),t.length>0&&(clearPointsButton.disabled=!1),updateDots(),repaintEditor(),void(unsavedChanges=!0)},clearPointsArray=e=>{selectedPoint=null,pointButtonContainer.innerHTML="",selectedComponent.points=[],updateDots(),repaintEditor()},updatePointX=e=>{selectedPoint.x=1*e,getButtonByID(selectedPoint.id,pointButtonContainer).innerHTML=`${selectedPoint.x}, ${selectedPoint.y}`,updateDots(),repaintEditor(),unsavedChanges=!0},updatePointY=e=>{selectedPoint.y=1*e,getButtonByID(selectedPoint.id,pointButtonContainer).innerHTML=`${selectedPoint.x}, ${selectedPoint.y}`,updateDots(),repaintEditor(),unsavedChanges=!0},editorPointerMoveHandler=e=>{editorBounds=editorCanvas.getBoundingClientRect();const t=editorCanvas.width/editorBounds.width,n=editorCanvas.height/editorBounds.height;if(mouseX=(e.clientX-editorBounds.left)*t,mouseY=(e.clientY-editorBounds.top)*n,roundedX=2*round(mouseX/2),roundedY=2*round(mouseY/2),dragging)selectedPoint.x=roundedX,selectedPoint.y=roundedY,pointXInput.value=selectedPoint.x,pointYInput.value=selectedPoint.y,getButtonByID(selectedPoint.id,pointButtonContainer).innerHTML=`${selectedPoint.x}, ${selectedPoint.y}`,updateDots(),repaintEditor(),unsavedChanges=!0;else if(selectedImage&&selectedComponent){let t=selectedComponent.points;for(let n=0;n<t.length;n++){const o=t[n],a=o.x-mouseX,i=o.y-mouseY;if(sqrt(a*a+i*i)<10)return setElementPosition(dotHover,editorBounds.left+o.x+dotOffsetX,editorBounds.top+o.y+dotOffsetY),hoveredPoint=o,void e.stopImmediatePropagation()}setElementPosition(dotHover,-50,-50),hoveredPoint=null}},pointInPolygon=(e,t)=>{let n,o,a,i=e.x,l=e.y;for(let e=0,s=t.length-1;e<t.length;s=e++)n=t[e].x,yi=t[e].y,o=t[s].x,yj=t[s].y,yi>l!=yj>l&&i<(o-n)*(l-yi)/(yj-yi)+n&&(a=!a);return a},editorPointerUpHandler=e=>{switch(e.button){case 2:if(selectedImage){let e=selectedImage.components.sort(((e,t)=>t.z-e.z));for(let t=0;t<e.length;t++){const n=e[t];if(pointInPolygon({x:mouseX,y:mouseY},n.points))return selectedPoint=null,void getButtonByID(n.id,componentButtonContainer).onclick()}}break;case 0:if(selectedComponent){if(dragging)return void(dragging=!1);addPoint(roundedX,roundedY),repaintEditor(),unsavedChanges=!0}}},editorPointerDownHandler=e=>{0==e.button&&hoveredPoint&&(getButtonByID(hoveredPoint.id,pointButtonContainer).onclick(),dragging=!0,hoveredPoint=null)},drawPolygon=(e,t,n=1)=>{editorContext.lineWidth=n,editorContext.strokeStyle=t,editorContext.beginPath(),editorContext.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)editorContext.lineTo(e[t].x,e[t].y);editorContext.closePath(),editorContext.stroke(),editorContext.lineWidth=1},repaintEditor=e=>{if(!doNotRepaint){if(editorContext.drawImage(editorBackgroundCanvas,0,0),selectedImage&&selectedImage.components.length>0){selectedImage.components=selectedImage.components.sort(((e,t)=>e.z-t.z));for(let e=0;e<selectedImage.components.length;e++){let t=selectedImage.components[e],n=t.points;n.length>2&&(t.center=n.reduce(((e,t)=>({x:e.x+t.x,y:e.y+t.y})),{x:0,y:0,a:0}),t.center.x/=n.length,t.center.y/=n.length,n=n.map((({x:e,y:n,id:o,type:a,name:i})=>({id:o,type:a,name:i,x:e,y:n,a:180*Math.atan2(n-t.center.y,e-t.center.x)/Math.PI}))).sort(((e,t)=>e.a-t.a)),t.points.forEach((e=>{n.forEach((t=>{t.id===e.id&&(e.a=t.a)}))})),editorContext.fillStyle=polygonCenterColor,editorContext.fillRect(t.center.x-3,t.center.y-3,7,7),drawPolygon(n,`#${palettes[t.palette][1]}`),t===selectedComponent&&drawPolygon(n,polygonHighlightColor,5)),editorContext.fillStyle=pointColor;for(let e=0;e<n.length;e++){const t=n[e];editorContext.fillRect(t.x-3,t.y-3,6,6)}}}repaintPreview()}},getBoundingBox=e=>{let t=510,n=510,o=0,a=0;for(let i=0;i<e.length;i+=2)e[i]<t&&(t=e[i]),e[i]>o&&(o=e[i]),e[i+1]<n&&(n=e[i+1]),e[i+1]>a&&(a=e[i+1]);return{x:t,y:n,w:o-t,h:a-n}},getContextBoundingBox=e=>{let t,n,o,a,i,l,s=512,d=e.getImageData(0,0,s,512).data;e:for(n=512;n--;)for(t=s;t--;)if(d[4*(s*n+t)+3]){l=n;break e}if(l){e:for(t=s;t--;)for(n=l+1;n--;)if(d[4*(s*n+t)+3]){i=t;break e}e:for(t=0;t<=i;++t)for(n=l+1;n--;)if(d[4*(s*n+t)+3]){o=t;break e}e:for(n=0;n<=l;++n)for(t=o;t<=i;++t)if(d[4*(s*n+t)+3]){a=n;break e}return{left:o,top:a,right:i,bottom:l,w:i-o,h:l-a}}},previewScaleSelected=e=>{previewScale=[1,.5,.25,.125,.0625][e],repaintPreview()},repaintPreview=e=>{if(!doNotRepaint&&(previewCanvas.width=previewCanvas.width,previewContext.drawImage(previewBackgroundCanvas,0,0),selectedImage&&arrayNotEmpty(selectedImage.components))){const e=selectedImage.components.sort(((e,t)=>e.z-t.z));for(let t=0;t<e.length;t++){const n=e[t];if(n.points.length>2){let e=n.blobbiness,t=n.points.sort(((e,t)=>e.a-t.a)).map((({x:e,y:t})=>[e*previewScale,t*previewScale]));t.unshift(t[t.length-1]),t.unshift(t[t.length-2]),t.push(t[2]),t.push(t[3]),t=t.flat();let o=t.length;previewContext.lineWidth=lineWidth*previewScale,previewContext.strokeStyle="#222",previewContext.beginPath(),previewContext.moveTo(t[2],t[3]);for(let n=2;n<o-4;n+=2){let a=t[n],i=t[n+1],l=t[n+2],s=t[n+3];previewContext.bezierCurveTo(a+(l-(n?t[n-2]:t[0]))/6*e,i+(s-(n?t[n-1]:t[1]))/6*e,l-((n!==o?t[n+4]:l)-a)/6*e,s-((n!==o?t[n+5]:s)-i)/6*e,l,s)}previewContext.stroke();let a,i,l,s=getBoundingBox(t);s.w>s.h?(a=s.x+.3*s.w,i=s.y+.2*s.h,l=.9*s.w):(a=s.x+.2*s.w,i=s.y+.3*s.h,l=.9*s.h),n.x0=floor(a),n.y0=floor(i),n.r1=floor(l);let d=previewContext.createRadialGradient(a,i,1,a,i,l),r=palettes[n.palette];d.addColorStop(0,`#${r[0]}`),d.addColorStop(.2,`#${r[1]}`),d.addColorStop(.6,`#${r[2]}`),previewContext.fillStyle=d,previewContext.fill()}}}},selectSelectedImageForDownload=e=>{selectedImage?(selectNoImagesForDownload(),getButtonByID(selectedImage.id,downloadSelectList).classList.add("selected")):notify("No images selected.")},selectAllImagesForDownload=e=>{for(let e=0;e<downloadSelectList.children.length;e++)downloadSelectList.children[e].classList.add("selected")},selectNoImagesForDownload=e=>{for(let e=0;e<downloadSelectList.children.length;e++)downloadSelectList.children[e].classList.remove("selected")},cancelImageDownload=e=>{showElement(downloadSelect,!1),downloadSelectVisible=!1},downloadImages=e=>{const t=[],n=Array.from(downloadSelectList.getElementsByClassName("selected"));for(let e=0;e<n.length;e++){const o=getFromArrayByID(n[e].id,dataFile.images),a={id:exportedBlobbyImageID,name:o.name,x:o.x,y:o.y,w:o.w,h:o.h,components:[]},i=o.components;for(let e=0;e<i.length;e++){const t=i[e],n={name:t.name,blobbiness:t.blobbiness,z:t.z,points:[],palette:t.palette},o=t.points;for(let e=0;e<o.length;e++){const t=o[e];n.points.push({x:t.x,y:t.y})}a.components.push(n)}t.push(a)}cancelImageDownload(),arrayNotEmpty(t)?downloadObjectAsJson(t,"exported.json"):notify("No images selected to download.")},openDownloadSelect=e=>{downloadSelectList.innerHTML="";const t=dataFile.images;for(let e=0;e<t.length;e++){const n=t[e],o=createElement("li");o.classList.add("listItem"),o.innerHTML=n.name,o.id=n.id,o.onclick=e=>o.classList.toggle("selected"),downloadSelectList.appendChild(o)}showElement(downloadSelect),downloadSelectVisible=!0},downloadObjectAsJson=(e,t)=>{const n=JSON.stringify(e),o=new Blob([n],{type:"application/json"}),a=URL.createObjectURL(o),i=createElement("a");i.href=a,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)},uploadImages=e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{fileInput.value="",doNotRepaint=!0;const t=JSON.parse(e.target.result);let n=t.length,o=!1,a=0,i=0;for(let e=0;e<t.length;e++)o|=recreateImportedImage(t[e]),o?a++:i++;doNotRepaint=!1,o&&(repaintEditor(),unsavedChanges=!0),notify(`${n} blobby images loaded. ${a} succeeded,  ${i} failed.`)},e.readAsText(t)}else notify("No file selected.")},checkImportedImageName=e=>{const t=dataFile.images;for(let n=0;n<t.length;n++)if(t[n].name===e.name)return void(e.name+="_"+dataFile.uid++)};function*uniqueIdentifierGenerator(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",t=1,n=0;for(;;){let o=[],a=n;for(let n=0;n<t;n++)o.unshift(e[a%e.length]),a=Math.floor(a/e.length);yield o.join(""),n++,n===Math.pow(e.length,t)&&(n=0,t++)}}recreateImportedImage=e=>{if(e.id&&e.id===exportedBlobbyImageID){checkImportedImageName(e);const t=addImage(e.name);t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h;const n=e.components;if(arrayNotEmpty(n))for(let e=0;e<n.length;e++){const t=n[e],o=addComponent();o.name=t.name,o.z=t.z,o.blobbiness=t.blobbiness,o.palette=t.palette;const a=t.points;if(arrayNotEmpty(a))for(let e=0;e<a.length;e++){const t=a[e];addPoint(t.x,t.y)}}return!0}return!1},writeClipboardText=async e=>{if(""!=e.innerText)try{await navigator.clipboard.writeText(e.innerText),notify("Copied to clipboard.")}catch(e){warn(e.message)}},enableCommentGeneration=e=>dataFile.generateComments=e,enableIndentGeneration=e=>dataFile.indentCode=e,setIndentSize=e=>dataFile.indentSize=1*e,indentCode=e=>dataFile.indentCode&&!dataFile.compactCode?"".padStart(dataFile.indentSize*e," "):"",setCodeCompacting=e=>{dataFile.compactCode=e,e?(generateCommentsCheckbox.disabled=!0,indentCodeCheckbox.disabled=!0,indentSizeInput.disabled=!0):(generateCommentsCheckbox.disabled=!1,indentCodeCheckbox.disabled=!1,indentSizeInput.disabled=!1)},newLine=e=>dataFile.compactCode?" ":"\n",charset="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/",encodeCoordinates=e=>e.map((e=>{const t=floor(e/64),n=e%64;return charset[t]+charset[n]})).join(""),calculateImageBoundingBox=e=>{const t=e.components;if(arrayNotEmpty(t)){tempCanvas.width=tempCanvas.width;for(let e=0;e<t.length;e++){const n=t[e];if(n.points.length>2){let e=n.blobbiness,t=n.points.sort(((e,t)=>e.a-t.a)).map((({x:e,y:t})=>[e*previewScale,t*previewScale]));t.unshift(t[t.length-1]),t.unshift(t[t.length-2]),t.push(t[2]),t.push(t[3]),t=t.flat();let o=t.length;tempContext.lineWidth=lineWidth*previewScale,tempContext.strokeStyle="#222",tempContext.beginPath(),tempContext.moveTo(t[2],t[3]);for(let n=2;n<o-4;n+=2){let a=t[n],i=t[n+1],l=t[n+2],s=t[n+3];tempContext.bezierCurveTo(a+(l-(n?t[n-2]:t[0]))/6*e,i+(s-(n?t[n-1]:t[1]))/6*e,l-((n!==o?t[n+4]:l)-a)/6*e,s-((n!==o?t[n+5]:s)-i)/6*e,l,s)}tempContext.stroke();let a,i,l,s=getBoundingBox(t);s.w>s.h?(a=s.x+.3*s.w,i=s.y+.2*s.h,l=.9*s.w):(a=s.x+.2*s.w,i=s.y+.3*s.h,l=.9*s.h),n.x0=floor(a),n.y0=floor(i),n.r1=floor(l)}}let n=getContextBoundingBox(tempContext);null!=n&&(e.x=n.left,e.y=n.top,e.w=n.w,e.h=n.h)}else e.x=0,e.y=0,e.w=0,e.h=0},exportImages=e=>{let t,n=`blobbyImages = [${newLine()}`;for(let e=0;e<dataFile.images.length;e++){const o=dataFile.images[e];calculateImageBoundingBox(o);const a=o.x,i=o.y;if(o.components.length>0){n+=`${indentCode(1)}[`,n+=dataFile.generateComments&&!dataFile.compactCode?` // ${o.name}.${newLine()}`:newLine();const e=o.components.sort(((e,t)=>e.z-t.z));for(let o=0;o<e.length;o++){const l=e[o];if(l.points.length>2){n+=`${indentCode(2)}[`,n+=dataFile.generateComments&&!dataFile.compactCode?` // ${l.name}.${newLine()}`:newLine();let e=l.points.sort(((e,t)=>e.a-t.a)).map((({x:e,y:t})=>[e*previewScale-a,t*previewScale-i])).flat(),o=encodeCoordinates(e);log(e),t="",n+=`${indentCode(3)}'${o}',`,n+=dataFile.generateComments&&!dataFile.compactCode?` // Points.${newLine()}`:newLine(),n+=`${indentCode(3)}${l.blobbiness},`,n+=dataFile.generateComments&&!dataFile.compactCode?` // Blobbiness.${newLine()}`:newLine(),n+=`${indentCode(3)}${l.palette}`,n+=dataFile.generateComments&&!dataFile.compactCode?` // Palette.${newLine()}`:newLine(),n+=`${indentCode(2)}],${newLine()}`}}n+=`${indentCode(2)}'${encodeCoordinates([o.w,o.h])}',`,n+=dataFile.generateComments&&!dataFile.compactCode?` // Dimensions.${newLine()}`:newLine(),n+=`${indentCode(1)}],${newLine()}`}}n+=`${indentCode(1)}${lineWidth*previewScale},`,n+=dataFile.generateComments&&!dataFile.compactCode?` // Line width.${newLine()}`:newLine(),n+=`${indentCode(1)}[`,n+=dataFile.generateComments&&!dataFile.compactCode?` // Palettes.${newLine()}`:newLine(),t="";for(let e=0;e<dataFile.palettes.length;e++){const n=dataFile.palettes[e].split(",");t+=indentCode(2);for(let e=0;e<n.length;e++)t+=`'${n[e]}', `;t+=newLine()}n+=t.substring(0,t.length-3),n+=`${newLine()}${indentCode(1)}],${newLine()}`,n=n.substring(0,n.length-2),n+=`${newLine()}];${newLine()}${newLine()}`,dataFile.compactCode&&(n=n.replaceAll(" ","")),n=`let ${n}`,n=highlightSyntax(n),outputCode.innerHTML=n,writeClipboardText(outputCode)};const uidGenerator=uniqueIdentifierGenerator(),getUID=e=>uidGenerator.next().value,highlightSyntax=e=>{let t,n=/(`[^`]*`)|(['"])(?:(?!\2)[^`\\]|\\.)*?\2/g,o=[],a=[],i={};for(;null!==(t=n.exec(e));)t[1]?a.push(t[1]):t[2]&&o.push(t[0]);for(let t=0;t<o.length;t++){const n=o[t];e=e.replace(n,`<span class="string">${n}</span>`)}const l=e=>e.startsWith("${")?`<span class="literal">\${</span><span class="keyword">${e.slice(2,-1)}</span><span class="literal">}</span>`:`<span class="string">${e}</span>`,s=a.map((e=>(e=>{const t=(e=e.slice(1,-1)).split(/(\$\{[^}]*\})/);return t[0]=`\`${t[0]}`,t[t.length-1]=`${t[t.length-1]}\``,t.filter((e=>""!==e))})(e).map(l)));for(let t=0;t<s.length;t++){let n=s[t],o="$literal$"+uidGenerator.next().value;e=e.replace(a[t],o),i[o]=n.join("")}const d=e.matchAll(/(\bfunction\s+(\w+)\b|\b(\w+)\s*=\s*(\(\s*[\w\s,]*\s*\)\s*|[\w\s,]*\s*)=>)/g),r=[];for(const e of d)e[2]?r.push(e[2]):e[3]&&r.push(e[3]);r.forEach((t=>{e=e.replace(new RegExp(t,"gi"),`<span class="func">${t}</span>`)}));e=(e=e.replace(/(\/\/.*?$|\/\*[\s\S]*?\*\/)/gm,'<span class="comment">$1</span>')).replace(/[\[\]]/g,(e=>`<span class="bracket">${e}</span>`));e=e.replace(/[()]/g,(e=>`<span class="parenthesis">${e}</span>`));e=e.replace(/[{}]/g,(e=>`<span class="curly-brace">${e}</span>`));e=e.replace(/(?<!['"])(\b\d+\b)(?!['"])/g,(e=>`<span class="number">${e}</span>`));const c=new RegExp(`\\b(${["function","const","let"].join("|")})\\b`,"g");e=(e=(e=(e=(e=e.replace(c,'<span class="keyword">$1</span>')).replace(/\b(\w+)(\.length)\b/g,'$1<span class="length">$2</span>')).replace(/;/g,'<span class="semicolon">$&</span>')).replace(/,/g,'<span class="semicolon">$&</span>')).replace(/=>/g,'<span class="arrow-function">$&</span>');Object.entries(i).forEach((([t,n])=>{e=e.replace(t,n)}));const p=new RegExp(`\\b(${["btoa"].join("|")})\\b`,"g");return e=(e=e.replace(p,'<span class="func">$1</span>')).replace(/\r?\n/g,"<br>")};onkeyup=e=>{switch(e.code){case"F2":showHelp(!helpVisible),e.stopImmediatePropagation();break;case"Enter":case"Escape":helpVisible?(showHelp(!1),e.stopImmediatePropagation()):colorPickerOpen?(showElement(colorPicker,!1),colorPickerOpen=!1,e.stopImmediatePropagation()):downloadSelectVisible&&(showElement(downloadSelect,!1),downloadSelectVisible=!1,e.stopImmediatePropagation(),"Enter"===e.code&&downloadImages())}},onkeydown=e=>{if(!helpVisible&&!anInputIsActive)switch(e.code){case"Backquote":e.ctrlKey?(selectedImage?cycleThroughButtonsInArray(selectedImage,dataFile.images,imageButtonContainer):dataFile.images.length>0&&cycleThroughButtonsInArray(dataFile.images[0],dataFile.images,imageButtonContainer),e.stopImmediatePropagation()):e.altKey?(selectedComponent?cycleThroughButtonsInArray(selectedComponent,selectedImage.components,componentButtonContainer):selectedImage.components.length>0&&cycleThroughButtonsInArray(selectedImage.components[selectedImage.components.length-1],selectedImage.components,componentButtonContainer),e.stopImmediatePropagation()):selectedPoint&&(cycleThroughButtonsInArray(selectedPoint,selectedComponent.points,pointButtonContainer,e.shiftKey?-1:1),e.stopImmediatePropagation());break;case"Delete":if(anInputIsActive)break;e.ctrlKey?(deleteImage(),e.stopImmediatePropagation()):e.shiftKey?(deleteComponent(),e.stopImmediatePropagation()):selectedPoint&&(deletePoint(),setElementPosition(dotSelect,-50,-50),e.stopImmediatePropagation());break;case"ArrowLeft":moveMultiplePoints(-2,0,e.shiftKey,e.ctrlKey),e.stopImmediatePropagation();break;case"ArrowRight":moveMultiplePoints(2,0,e.shiftKey,e.ctrlKey),e.stopImmediatePropagation();break;case"ArrowUp":moveMultiplePoints(0,-2,e.shiftKey,e.ctrlKey),e.stopImmediatePropagation();break;case"ArrowDown":moveMultiplePoints(0,2,e.shiftKey,e.ctrlKey),e.stopImmediatePropagation()}},onpointerup=e=>{if(colorPickerOpen){const t=colorPickerDialog.getBoundingClientRect();(e.pageX<t.left||e.pageX>t.right||e.pageY<t.top||e.pageY>t.bottom)&&(showElement(colorPicker,!1),colorPickerOpen=!1,e.preventDefault())}else if(downloadSelectVisible){const t=downloadSelectBody.getBoundingClientRect();(e.pageX<t.left||e.pageX>t.right||e.pageY<t.top||e.pageY>t.bottom)&&(showElement(downloadSelect,!1),downloadSelectVisible=!1,e.preventDefault())}else if(helpVisible){if(0!=e.button)return;const t=e.pageX,n=e.pageY,o=helpBody.getBoundingClientRect();(t<o.left||t>o.right||n<o.top||n>o.bottom)&&showHelp(!1),e.preventDefault()}},onload=e=>{editorBounds=editorCanvas.getBoundingClientRect(),dataFile=loadDataFile(),dataFile?dataFile=JSON.parse(dataFile):resetDataFile(),initImageArray(),initPalettes(),editorCanvas.onpointermove=editorPointerMoveHandler,editorCanvas.onpointerup=editorPointerUpHandler,editorCanvas.onpointerdown=editorPointerDownHandler,generateCommentsCheckbox.checked=dataFile.generateComments,indentCodeCheckbox.checked=dataFile.indentCode,indentSizeInput.value=dataFile.indentSize,compactCodeCheckbox.checked=dataFile.compactCode,imageNameInput.disabled=!0,deleteImageButton.disabled=!0,saveImagesButton.disabled=!(dataFile.images.length>0),downloadImagesButton.disabled=!(dataFile.images.length>0),duplicateImageButton.disabled=!0,flipImageXButton.disabled=!0,flipImageYButton.disabled=!0,componentNameInput.disabled=!0,componentBlobbinessRange.disabled=!0,componentBlobbinessInput.disabled=!0,addComponentButton.disabled=!0,deleteComponentButton.disabled=!0,componentZIndexRange.disabled=!0,componentZIndexInput.disabled=!0,flipComponentXButton.disabled=!0,flipComponentYButton.disabled=!0,paletteContainer.disabled=!0,openColorPickerButton.disabled=!0,deletePointButton.disabled=!0,clearPointsButton.disabled=!0,pointXInput.disabled=!0,pointYInput.disabled=!0,duplicateComponentButton.disabled=!0,enablePaletteSwatches(!1),window.onbeforeunload=e=>{unsavedChanges&&(e.preventDefault(),e.returnValue=!0)};const t='\nlet \ngradientID = 0, // every gradient must be unique.\n\n// Render the blobby image at the given index.\nrenderBlobbyImage = index => {\n\n  let \n  // Get the size (length) of the given array.\n  sizeOf = array => (array.length),\n\n  // Decode the given encoded ASCII into an array numbers.\n  decodeCoordinates = encoded => {\n    let \n    charset = \'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVW&lt&gtZ+/\',\n    coords = [];\n    for (let i = 0; i < sizeOf(encoded); i += 2) coords.push(charset.indexOf(encoded[i]) * 64 + charset.indexOf(encoded[i + 1]));\n    return coords;\n  },\n\n  image = blobbyImages[index],\n\n  imageToRenderSize = sizeOf(image),\n\n  blobbyImagesSize = sizeOf(blobbyImages),\n\n  palettes = blobbyImages[blobbyImagesSize - 1],\n\n  [imageWidth, imageHeight] = decodeCoordinates(image[imageToRenderSize - 1]),\n\n  svgString = `&ltsvg viewBox="0 0 ${imageWidth} ${imageHeight}" width="${imageWidth}" height="${imageHeight}" xmlns="http://www.w3.org/2000/svg"&gt&ltdefs&gt`,\n\n  xxxString = \'what the fuck\',\n\n  pathsString = \'\',\n\n  svgColorStop = (offset, color) => svgString += `&ltstop offset="${offset}" stop-color="#${color}"/&gt`,\n\n  img = new Image();\n\n  // Render components loop.\n  for (let j = 0; j < imageToRenderSize - 1; j++) {\n    let \n    component = image[j],\n\n    blobbiness = component[1],\n    paletteIndex = component[2] * 3, // 3 color strings per palette.\n\n    points = decodeCoordinates(component[0]);\n\n    // Some points need to be duplicated.\n    for (let k = 0; k < 6; k++) points.push(points[k]);\n\n    let \n    pointsSize = sizeOf(points),\n\n    path = \'M\' + [points[2],  points[3]]; // Begin path.\n\n    for (let i = 2; i < pointsSize; i += 2) {\n      let \n      x1 = points[i],\n      y1 = points[i + 1],\n\n      x2 = points[i + 2],\n      y2 = points[i + 3];\n\n      path += \'C\' + [x1 + ((x2 - (i ? points[i - 2] : points[0])) / 6) * blobbiness, \n        y1 + ((y2 - (i ? points[i - 1] : points[1])) / 6) * blobbiness, \n        x2 - (((i !== pointsSize ? points[i + 4] : x2) - x1) / 6) * blobbiness, \n        y2 - (((i !== pointsSize ? points[i + 5] : y2) - y1) / 6) * blobbiness, \n        x2, y2]; // Extend path.\n    }\n\n    // Append component gradient.\n    svgString += `&ltradialGradient id="g${gradientID}" r="90%" cx="30%" cy="30%"&gt`;\n    svgColorStop(0, palettes[paletteIndex ++]);\n    svgColorStop(.2, palettes[paletteIndex ++]);\n    svgColorStop(.6, palettes[paletteIndex ++]);\n    svgString += `&lt/radialGradient>`;\n\n    // Append component path.\n    pathsString += `&ltpath d="${path}" stroke="#000" stroke-width="${blobbyImages[blobbyImagesSize - 2]}" fill="url(#g${gradientID++})"/&gt`;\n  }\n\n  // Execute this code when the image has fully loaded.\n  img.onload = () => {\n    // Do whatever with the image now.\n    imageContainer.appendChild(img); // Example displays it in an HTML div.\n  }\n\n  img.src = `data:image/svg+xml;base64,${btoa(svgString + \'&lt/defs&gt\' + pathsString + \'&lt/svg&gt\')}`; // Mime encode SVG and set it to the images source (start it loading).\n};\n\n// Execute this code when the page has fully loaded.\nonload = e => {\n  for (let i = 0; i < blobbyImages.length - 2; i++) renderBlobbyImage(i);\n};\n';blobbyRenderCode.innerHTML=highlightSyntax(t.replace(/\\`/g,"`"));const n=previewBackgroundCanvas.getContext("2d"),o=n.createRadialGradient(256,256,1,256,256,256);previewBackgroundCanvas.width=512,previewBackgroundCanvas.height=512,o.addColorStop(0,"#777"),o.addColorStop(1,"#555"),n.fillStyle=o,n.fillRect(0,0,512,512),previewContext.drawImage(previewBackgroundCanvas,0,0);const a=editorBackgroundCanvas.getContext("2d");editorBackgroundCanvas.width=512,editorBackgroundCanvas.height=512,a.fillStyle="#555",a.fillRect(0,0,512,512),a.lineWidth=1,a.setLineDash([1,7]),a.beginPath(),a.strokeStyle="#000";for(let e=0;e<512;e+=8)a.moveTo(e+0,0),a.lineTo(e+0,512);a.stroke(),a.setLineDash([3,5]),a.strokeStyle="#888",a.beginPath();for(let e=0;e<512;e+=128)a.moveTo(e+.5,0),a.lineTo(e+.5,512),a.moveTo(.5,e+.5),a.lineTo(512,e+.5);a.stroke(),editorContext.drawImage(editorBackgroundCanvas,0,0),notify("Welcome to the blobby image editor. Press F2 for help",4e3)}</script>
</html>